<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JurisSocial</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background: #000; color: #e7e9ea; font-family: -apple-system, sans-serif; margin: 0; }
        
        /* Cabeçalho Fixo */
        .header { 
            position: sticky; top: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); 
            padding: 15px; border-bottom: 1px solid #2f3336; z-index: 99; text-align: center; font-weight: bold; font-size: 1.2rem;
        }

        .feed-container { max-width: 600px; margin: 0 auto; border-left: 1px solid #2f3336; border-right: 1px solid #2f3336; min-height: 100vh; }

        /* Estilo do Post */
        .post { padding: 15px; border-bottom: 1px solid #2f3336; display: flex; gap: 12px; }
        
        /* Avatares Coloridos por Perfil */
        .avatar { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;}
        
        .cor-cp  { background: #d32f2f; color: white; } /* Penal (Vermelho) */
        .cor-cpp { background: #c2185b; color: white; } /* Proc Penal (Rosa) */
        .cor-cpc { background: #1976d2; color: white; } /* Civil (Azul) */
        .cor-cf  { background: #fbc02d; color: black; } /* Const (Amarelo) */
        .cor-stf { background: #fff; color: black; border: 1px solid #ccc; } 
        .cor-stj { background: #90a4ae; color: black; }

        .content { width: 100%; }
        .meta { display: flex; justify-content: space-between; color: #71767b; font-size: 0.9rem; margin-bottom: 5px; }
        .author-name { font-weight: bold; color: #e7e9ea; margin-right: 5px; }
        
        .post-text { font-size: 1rem; line-height: 1.5; white-space: pre-wrap; }
        
        .actions { margin-top: 10px; display: flex; justify-content: space-between; color: #71767b; max-width: 80%; }
        .material-icons { font-size: 18px; cursor: pointer; }

        /* Badge de Notícia Fresca */
        .tag-news { background: #1d9bf0; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; display: inline-block; margin-bottom: 6px; }

    </style>
</head>
<body>

    <div class="header">⚖️ JurisSocial</div>
    
    <div class="feed-container" id="feed">
        </div>
    <div id="loader" style="text-align:center; padding:20px; color:gray;">Carregando mais...</div>

    <script>
        // Configuração visual dos perfis
        const configPerfis = {
            'cp':  { nome: 'Código Penal', user: '@penal', css: 'cor-cp' },
            'cpp': { nome: 'Proc. Penal', user: '@cpp_raiz', css: 'cor-cpp' },
            'cpc': { nome: 'Proc. Civil', user: '@cpc_2015', css: 'cor-cpc' },
            'cf':  { nome: 'Constituição', user: '@cf88', css: 'cor-cf' },
            'stf': { nome: 'STF Oficial', user: '@supremo', css: 'cor-stf' },
            'stj': { nome: 'STJ Oficial', user: '@stj_jus', css: 'cor-stj' }
        };

        let bancoDeDados = [];

        // 1. Carrega os dados gerados pelo Robô
        fetch('db.json')
            .then(r => r.json())
            .then(data => {
                bancoDeDados = data;
                renderizarPosts(10); // Começa mostrando 10
            })
            .catch(e => console.log("Erro ao carregar dados. Rode o scraper primeiro."));

        const feedDiv = document.getElementById('feed');

        // 2. Renderiza os posts
        function renderizarPosts(qtd) {
            // Pega 'qtd' posts aleatórios do banco (simulação de infinito)
            for(let i=0; i<qtd; i++) {
                const item = bancoDeDados[Math.floor(Math.random() * bancoDeDados.length)];
                if(!item) continue;

                const perfil = configPerfis[item.perfil] || { nome: 'Lei', user: '@lei', css: 'cor-stj' };
                const badge = item.tipo === 'noticia' ? '<span class="tag-news">PLANTÃO</span><br>' : '';

                const html = `
                    <div class="post">
                        <div class="avatar ${perfil.css}">${perfil.nome.substring(0,2)}</div>
                        <div class="content">
                            <div class="meta">
                                <div><span class="author-name">${perfil.nome}</span> <span>${perfil.user}</span></div>
                            </div>
                            <div class="post-text">${badge}${item.texto}</div>
                            <div class="actions">
                                <i class="material-icons">chat_bubble_outline</i>
                                <i class="material-icons">repeat</i>
                                <i class="material-icons">favorite_border</i>
                                <i class="material-icons">share</i>
                            </div>
                        </div>
                    </div>
                `;
                feedDiv.insertAdjacentHTML('beforeend', html);
            }
        }

        // 3. Sensor de "Fim da Página" (Infinite Scroll)
        window.addEventListener('scroll', () => {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
                // Quando chega no fim, carrega mais 5 posts aleatórios
                renderizarPosts(5);
            }
        });

    </script>
</body>
</html>
