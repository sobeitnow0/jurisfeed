<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JurisSocial Vade Mecum</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* --- CSS B츼SICO --- */
        body { background: #000; color: #e7e9ea; font-family: -apple-system, sans-serif; margin: 0; overflow-x: hidden; }
        .header { position: sticky; top: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); padding: 15px; border-bottom: 1px solid #2f3336; z-index: 90; text-align: center; font-weight: bold; font-size: 1.2rem; cursor: pointer;}
        
        .feed-container { max-width: 600px; margin: 0 auto; min-height: 100vh; padding-bottom: 80px;}

        /* --- POSTAGEM --- */
        .post { padding: 15px; border-bottom: 1px solid #2f3336; display: flex; gap: 12px; }
        .avatar { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; cursor: pointer; transition: transform 0.2s; }
        .avatar:active { transform: scale(0.9); }
        
        /* Cores */
        .cor-cp { background: #d32f2f; color: white; }
        .cor-cpp { background: #c2185b; color: white; }
        .cor-cpc { background: #1976d2; color: white; }
        .cor-cf { background: #fbc02d; color: black; }
        .cor-stf { background: #fff; color: black; }
        .cor-stj { background: #90a4ae; color: black; }

        .content { width: 100%; }
        .meta { display: flex; justify-content: space-between; color: #71767b; font-size: 0.9rem; }
        .author-name { font-weight: bold; color: #e7e9ea; margin-right: 5px; cursor: pointer; }
        .author-name:hover { text-decoration: underline; }
        
        .post-text { font-size: 1rem; line-height: 1.5; margin-top: 5px; white-space: pre-wrap; }
        .tag-news { background: #1d9bf0; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }

        /* --- MODAL DO PERFIL (O "VADE MECUM") --- */
        .modal {
            display: none; /* Escondido por padr칚o */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; overflow-y: auto;
        }

        .modal-header {
            position: sticky; top: 0; background: rgba(0,0,0,0.9);
            padding: 10px; display: flex; align-items: center; gap: 15px;
            border-bottom: 1px solid #2f3336; z-index: 101;
        }

        .btn-voltar { background: none; border: none; color: white; cursor: pointer; }
        
        .profile-hero {
            padding: 20px; text-align: center; border-bottom: 1px solid #2f3336;
            background: linear-gradient(180deg, rgba(29,155,240,0.1) 0%, rgba(0,0,0,0) 100%);
        }

        .big-avatar { width: 80px; height: 80px; font-size: 1.5rem; margin: 0 auto 10px auto; }
        
        .btn-pdf {
            display: inline-block; margin-top: 15px; padding: 10px 20px;
            background: #e7e9ea; color: #000; text-decoration: none;
            border-radius: 20px; font-weight: bold; font-size: 0.9rem;
        }

        /* Visualizador PDF embutido (Iframe) */
        .pdf-viewer {
            width: 100%; height: 500px; border: none; background: #fff;
            margin-top: 20px; border-radius: 8px; display: none;
        }
        
        /* Mobile adjustment for PDF */
        @media (max-width: 600px) {
            .pdf-viewer { height: 70vh; }
        }

    </style>
</head>
<body>

    <div class="header" onclick="location.reload()">丘뒲잺 JurisSocial</div>
    <div class="feed-container" id="feed-principal">
        </div>
    <div style="text-align:center; padding:20px; color:#555">Carregando feed...</div>

    <div id="modal-perfil" class="modal">
        <div class="modal-header">
            <button class="btn-voltar" onclick="fecharPerfil()"><i class="material-icons">arrow_back</i></button>
            <h3 id="modal-titulo" style="margin:0">Perfil</h3>
        </div>

        <div class="profile-hero">
            <div id="modal-avatar" class="avatar big-avatar">CP</div>
            <h2 id="modal-nome">C칩digo Penal</h2>
            <div id="modal-user" style="color:#71767b">@penal</div>
            
            <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                <button class="btn-pdf" onclick="togglePDF()">游늯 Ler Lei na 칈ntegra (PDF)</button>
            </div>

            <iframe id="frame-pdf" class="pdf-viewer" src=""></iframe>
        </div>

        <div class="feed-container" id="feed-perfil">
            <div style="padding:15px; color:#71767b; font-size:0.9rem">칔LTIMAS PUBLICA칂칏ES DESTE C칍DIGO</div>
            </div>
    </div>


    <script>
        // --- 1. CONFIGURA칂츾O (Agora com link para PDF) ---
        // Certifique-se de subir arquivos com esses nomes na pasta 'pdfs' do GitHub
        const perfis = {
            'cp':  { nome: 'C칩digo Penal', user: '@penal', css: 'cor-cp', pdf: 'pdfs/cp.pdf' },
            'cpp': { nome: 'Proc. Penal', user: '@cpp_raiz', css: 'cor-cpp', pdf: 'pdfs/cpp.pdf' },
            'cpc': { nome: 'Proc. Civil', user: '@cpc_2015', css: 'cor-cpc', pdf: 'pdfs/cpc.pdf' },
            'cf':  { nome: 'Constitui칞칚o', user: '@cf88', css: 'cor-cf', pdf: 'pdfs/cf.pdf' },
            'stf': { nome: 'STF Oficial', user: '@supremo', css: 'cor-stf', pdf: 'pdfs/stf_info.pdf' },
            'stj': { nome: 'STJ Oficial', user: '@stj_jus', css: 'cor-stj', pdf: 'pdfs/stj_info.pdf' }
        };

        let dadosGlobais = [];

        // --- 2. CARREGAMENTO ---
        fetch('db.json')
            .then(r => r.json())
            .then(data => {
                dadosGlobais = data;
                renderizarFeedPrincipal(20);
            })
            .catch(() => console.log("Erro ao carregar DB."));

        // --- 3. FUN칂칏ES VISUAIS ---

        function criarHTMLPost(item) {
            const p = perfis[item.perfil] || { nome: 'Lei', user: '@lei', css: 'cor-stj' };
            const badge = item.tipo === 'noticia' ? '<span class="tag-news">PLANT츾O</span><br>' : '';
            
            return `
                <div class="post">
                    <div class="avatar ${p.css}" onclick="abrirPerfil('${item.perfil}')">
                        ${p.nome.substring(0,2)}
                    </div>
                    <div class="content">
                        <div class="meta">
                            <div>
                                <span class="author-name" onclick="abrirPerfil('${item.perfil}')">${p.nome}</span> 
                                <span>${p.user}</span>
                            </div>
                        </div>
                        <div class="post-text">${badge}${item.texto}</div>
                    </div>
                </div>
            `;
        }

        function renderizarFeedPrincipal(qtd) {
            const container = document.getElementById('feed-principal');
            for(let i=0; i<qtd; i++) {
                // Pega aleat칩rio
                const item = dadosGlobais[Math.floor(Math.random() * dadosGlobais.length)];
                if(item) container.innerHTML += criarHTMLPost(item);
            }
        }

        // --- 4. L칍GICA DO PERFIL / PDF ---

        let perfilAtual = null;

        function abrirPerfil(codigoPerfil) {
            const p = perfis[codigoPerfil];
            if(!p) return;

            perfilAtual = p;

            // Preenche os dados do Modal
            document.getElementById('modal-titulo').innerText = p.nome;
            document.getElementById('modal-nome').innerText = p.nome;
            document.getElementById('modal-user').innerText = p.user;
            
            const divAvatar = document.getElementById('modal-avatar');
            divAvatar.className = `avatar big-avatar ${p.css}`;
            divAvatar.innerText = p.nome.substring(0,2);

            // Prepara o PDF (mas n칚o mostra ainda pra n칚o pesar)
            const frame = document.getElementById('frame-pdf');
            frame.style.display = 'none'; // Reseta estado
            frame.src = p.pdf ? p.pdf : ''; // Define o arquivo

            // Filtra o feed s칩 desse perfil
            const postsDoPerfil = dadosGlobais.filter(item => item.perfil === codigoPerfil);
            const containerPerfil = document.getElementById('feed-perfil');
            containerPerfil.innerHTML = '<div style="padding:15px; color:#71767b; font-size:0.9rem">HIST칍RICO DE POSTAGENS</div>';
            
            postsDoPerfil.forEach(item => {
                containerPerfil.innerHTML += criarHTMLPost(item);
            });

            // Mostra a tela
            document.getElementById('modal-perfil').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Trava rolagem do fundo
        }

        function fecharPerfil() {
            document.getElementById('modal-perfil').style.display = 'none';
            document.body.style.overflow = 'auto'; // Destrava rolagem
            document.getElementById('frame-pdf').src = ''; // Limpa PDF para economizar mem칩ria
        }

        function togglePDF() {
            const frame = document.getElementById('frame-pdf');
            const btn = document.querySelector('.btn-pdf');
            
            if(!perfilAtual.pdf) {
                alert("PDF n칚o dispon칤vel para este perfil.");
                return;
            }

            if (frame.style.display === 'none') {
                frame.style.display = 'block';
                btn.innerText = "Fechar PDF";
            } else {
                frame.style.display = 'none';
                btn.innerText = "游늯 Ler Lei na 칈ntegra (PDF)";
            }
        }

        // Scroll Infinito no Principal
        window.addEventListener('scroll', () => {
            const modalOpen = document.getElementById('modal-perfil').style.display === 'block';
            if (!modalOpen && (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
                renderizarFeedPrincipal(5);
            }
        });

    </script>
</body>
</html>
